---
类型:
  - 效率工具
  - 数据备份
---
# 为什么要做这件事情？

1. 为什么需要图床？
   A：文章发布到公众号B站等平台，比较方便
2. Obsidian如何快速上传和使用图床上的图片？
   A：Image-Auto-Upload-plugin + PicList + WebDav服务器
   功能：
   - WebDav服务器：用来存放照片，并且通过连接可以直接访问
   - PicList：基于PicGo的改进版图片上传工具，直接支持WebDav服务器
   - Image-Auto-Upload-plugin：Obsidian内的图片自动上传工具，用来自动触发PicGo的上传操作
- 
3. 选择什么平台？
   A：商用平台：
   - OSS：数据迁移困难（感觉上），收费
   - Github：访问慢，不一定总能访问到
4. 自建图床的优缺点？适合什么情况？
   A：优点：
   - 国内可以访问到
   - 如果已经租过服务器，可以直接用它。没租过的话，一年100元以内
   - 使用免费的坚果云也可以
   - 数据完全由自己控制，想怎么来就怎么来
    缺点：
   - Image-Auto-Upload-plugin不支持手机版Obsidian
   - 需要自己配置

# 配置过程
## 第一部分：技术选择和服务器准备

我对图床的要求：
- 无需密码可以直接查看图片
- 增删图片需要密码
- 配置足够简单，并且尽可能支持多平台

所以我的选择是：问GPT。。。我问它用nginx和docker如何实现webdav应用，他告诉了我nginx的方式，我觉得太复杂，然后它告诉我使用 ‘bytemark/webdav’ 镜像就可以做到。稍微了解了一下，发现这个镜像实现了简单的webdav服务器功能，并且可以指定哪些请求可以跳过验证，也就是说我们可以让查看图片不需要密码，而其他操作需要，完美符合要求。使用docker部署也足够简单，非常好。当然，前提是我们需要安装docker和docker compose，安装比较简单，按照[官网教程](https://docs.docker.com/engine/install/ubuntu/)安装即可。

服务器的选择，有三种选择：本机，局域网（如家庭NAS），云服务器

图床放在哪里都可以，我们的目的是从Obsidian可以访问到它，只要它有计算能力，有足够的磁盘空间来放置我们的图片和程序文件即可。

图床放在本机有意义吗？我认为有意义，一方面可以减少笔记文件夹里附件的散落，大量图片保存在Obsidian笔记文件夹里会大幅度减慢打开速度，文件也几乎无法管理。而使用图床程序，可以减少笔记文件夹内文件的复杂性，将来增加图片管理功能也是可能的。

如果把图床放在本机或局域网里，只要保证服务器或本机开启即可。如果选择放在云服务器上，记得开启防火墙端口。云服务器一般会在类似于 `安全组——进出规则` 这样的路径中找到对应的设置。

另外，如果有域名，建议绑定域名，将来如果涉及到云服务器的迁移，我们笔记端将不需要任何更改即可使用所有图片。这部分内容请自行搞定。如果有不清楚的可以私信我讨论。

## 第二部分：运行图床程序

**第一步**：在服务器上创建一个文件夹，比如webdav，然后创建文件：`docker-compose.yml`，内容如下，其中可能需要按需定制的部分如下：

- - "50000:80" ：前面的端口是你希望通过什么端口访问服务器，后面的80不要变
- AUTH_TYPE: Digest ：这里我没有配置SSL证书，Digest最佳
- USERNAME: 用户名
- PASSWORD: 密码
- ANONYMOUS_METHODS: GET ： 哪些请求可以跳过验证，我这里是GET，就是查看图片无需验证
- - /root/pics:/var/lib/dav： 冒号前面的是你本机放置图片的路径，后面不要改。如果希望在当前目录下放置图片，修改为：`- ./:/var/lib/dav`

~~~
version: '3'
services:
  webdav:
    image: bytemark/webdav
    restart: always
    ports:
      - "50000:80"
    environment:
      AUTH_TYPE: Digest
      USERNAME: 用户名
      PASSWORD: 密码
      ANONYMOUS_METHODS: GET
    volumes:
      - /root/pics:/var/lib/dav
~~~

**第二步**：运行命令：`docker compose up -d` 部署完成。

接下来就可以测试了，如果你的服务器IP是：47.47.47.47，配置的端口是50000，那么你只需要在浏览器内访问：http://47.47.47.47:50000就好了，出现的界面应该类似于这样的

![image.png](http://pic.dellyqiao.com:3011/202403011822175_1709288540.png)

**第三步**：配置PicList。
1. 在官网下载对应版本的PicList：https://github.com/Kuingsmile/PicList/releases/tag/v2.7.4
2. 安装软件，win11的话下一步到底就好
3. 打开软件，如图配置：![image.png](http://pic.dellyqiao.com:3011/202403011825572_1709288739.png)
![image.png](http://pic.dellyqiao.com:3011/202403011830863_1709289041.png)
4. 把这个图床设置为默认图床，之后点击软件界面的“上传”，上传图片测试。设置里也有开机启动的选项，按需打开
5. 相册可以进行图片管理，如果希望相册这里删掉，服务器上也同步删掉，点击右上角的删除云端
   ![image.png](http://pic.dellyqiao.com:3011/202403011832182_1709289142.png)

**第四步**：打开Obsidian，配置插件

安装Image Auto Upload插件，如果你跟我一样使用Win11版PicGo，插件安装启用就好了，可以根据自己需求启用具体功能。
![image.png](http://pic.dellyqiao.com:3011/202403011834930_1709289252.png)


接下来，截图粘贴到Obsidian里，如果可以自动上传并自动把图片链接插入到文档中，代表流程跑通，正常使用就好。

## 第三部分：关于数据的迁移备份的想法和讨论

### 关于迁移

如果有多台设备协作使用，我的使用方法是：
- Win/Mac电脑配置Obsidian插件+PicList+云服务器图床
- 安卓手机端使用作者写的APP：[PicHoro](https://github.com/Kuingsmile/PicHoro) ，手工上传图片，获取图片链接，插入Obsidian

如果您有绑定域名，使用域名访问，那么只需要把原本服务器上，把图片文件夹整个拷贝到新服务器上，使用docker在新服务器上启动服务，把域名指向到新的服务器，即可无缝使用。如果未绑定域名，那么就需要在Obsidian里查找原本的IP名，替换成新的IP。

### 关于备份

我自建图床的其中一个目的就是为了能自由地使用我自己的备份方案。服务器上数据的备份我有几种想法，请大家按照自己的想法和能力水平，以最小的代价来设计自己的备份方案。我的想法包括：
1. 如果你会使用git，请使用cron job定期触发git备份到github或者gitee即可
2. 安装同步软件，我个人使用resilio-sync，支持全平台，比较好用
3. 其他任何可以备份数据的方法


自建图床的内容就分享到这里，其实自建图床本身不难，但综合起来，选择什么样的平台部署，如何处理网络解析，如何解决数据备份迁移的问题，需要做的选择比较多，千人千面。

如果您懂一定的网站建站的内容，碰巧你也需要自建图床，按照我讲的方法，你可以很快搞出自己专属的图床。如果您一点技术不懂，请在评论区留言告诉我你卡在了什么地方，希望我更新哪方面的内容，或私信找我咨询，我会根据大家的需求更新后续的内容。

感谢您的观看，如果我的内容帮到了您，请不吝三连，您的支持对我非常重要。我们下个视频见。
